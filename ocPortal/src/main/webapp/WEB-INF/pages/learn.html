<!DOCTYPE html>
<html lang="utf-8">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>在线网校学习平台</title>

    <link href="../../res/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../res/css/reset.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../res/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../../res/js/bootstrap.min.js"></script>

    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="icon" type="image/png" href="../../res/i/ico.png" sizes="16x16">
    <script type="text/javascript">
        CONETXT_PATH = '';
    </script>
</head>

<body>
<!-- 头部-start -->
<div class="f-header">
    <div class="f-header-box clearfix">
        <a href=".." class="logo" title="网校在线学习平台"></a>
        <nav class="header-nav">
            <a href=".." class="header-nav-item">首 页</a>
            <a href="../course/list.html" class="header-nav-item">课 程</a>
            <a href="../user/home.html" class="header-nav-item">我的</a>
            <a href="../opt/index.html" style="width:100px;" target="_blank" class="header-nav-item">运营CMS</a>
        </nav>

        <nav class="header-nav" style="float:right">
            <a href="#myModal" class="header-nav-item" data-toggle="modal" onclick="login();"
               style="margin-right:0px;font-size:14px;">登录</a>
            <a href="../auth/register.html" class="header-nav-item" style="margin-left:0px;font-size:14px;">注册</a>
            <a href="#" class="header-nav-item" style="margin-left:0px;font-size:14px;" id="userdetail">头像</a>
        </nav>
    </div>
</div>
<script type="text/javascript">
    function login() {
        $('#loginTitle').css('color', '#337Ab7');
        $('#loginForm').show();
        $('#registeTitle').css('color', '#000');
        $('#registeForm').hide();
    }

    function registe() {
        $('#loginTitle').css('color', '#000');
        $('#loginForm').hide();
        $('#registeTitle').css('color', '#337Ab7');
        $('#registeForm').show();
    }

    $(function () {
        $("#userdetail").popover({
            trigger: 'manual',
            placement: 'bottom',
            html: 'true',
            content: '<div style="width:300px;height:300px;"></div>',
            animation: false
        }).on("mouseenter", function () {
            var _this = this;
            $(this).popover("show");
            $(this).siblings(".popover").on("mouseleave", function () {
                $(_this).popover('hide');
            });
        }).on("mouseleave", function () {
            var _this = this;
            setTimeout(function () {
                if (!$(".popover:hover").length) {
                    $(_this).popover("hide")
                }
            }, 0);
        });
        //课程分类展示
        $(".category").popover({
            trigger: 'manual',
            placement: 'right',
            html: 'true',
            content: '',
            animation: false
        }).on("mouseenter", function () {
            var cid = $(this).attr('c-id');
            $('#' + cid).show();
            $('#' + cid).hover(function () {
                $('#' + cid).show();
            }, function () {
                $('#' + cid).hide();
            });
        }).on("mouseleave", function () {
            var cid = $(this).attr('c-id');
            $('#' + cid).hide();
        });
    });
</script>
<!-- 头部-end -->

<!-- 登录注册-start -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" style="position:fixed; top:30%;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="font-size:18px;">×</span>
                </button>
                <h4 class="modal-title" id="loginTitle" style="float: left; color: #337Ab7;cursor: pointer; "
                    onclick="login();">登 录</h4>
                <h4 class="modal-title" id="registeTitle" style="float: left;margin-left: 20px;cursor: pointer;"
                    onclick="registe();">注 册</h4>
                <div class="clearfix"></div>
            </div>

            <div class="modal-body">
                <form id="loginForm" class="form-horizontal" style="padding: 0px 20px;">
                    <div class="form-group">
                        <input type="email" class="form-control" id="username" placeholder="用户名">
                    </div>
                    <div class="form-group help">
                        <input type="password" class="form-control" id="password" placeholder="密　码">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" value="None" id="checkbox1" name="check">
                            <span class="text" style="color: #787D82;font-size: 14px;">下次自动登录</span>
                        </label>
                    </div>

                    <a href="javascript:void(0)">
                        <div class="header-login-btn">登 录</div>
                    </a>
                </form>

                <form id="registeForm" class="form-horizontal" style="padding: 0px 20px;display: none;">
                    <div class="form-group">
                        <input type="email" class="form-control" id="username" placeholder="用户名">
                    </div>
                    <div class="form-group help">
                        <input type="password" class="form-control" id="password" placeholder="密　码">
                    </div>
                    <a href="javascript:void(0)">
                        <div class="header-login-btn">注 册</div>
                    </a>
                </form>

            </div>

        </div>
    </div>
</div>
<!-- 登录注册-end -->

<div class="f-main clearfix">
    <div class="f-main clearfix">
        <div class="main-course-left">
            <!-- 基础信息 - start -->
            <div class="course-info">
                <div class="course-title">${(course.name)!}</div>

                <div class="course-meta">
                    <a href="${s.base}/course/video/12.html" class="learn-btn">继续学习</a>

                    <div class="static-item">
                        <div class="meta">上次学到</div>
                        <div class="meta-value" title="${(curCourseSection.name)!}">${(curCourseSection.name)!}</div>
                    </div>

                    <div class="static-item">
                        <div class="meta">学习人数</div>
                        <div class="meta-value">${(course.studyCount)!}</div>
                    </div>
                    <div class="static-item">
                        <div class="meta">难度级别</div>
                        <div class="meta-value">
                            <#if course?? && course.level??>
                                <#if course.level == 1>
                                    初级
                                    <#elseif course.level == 2>
                                        中级
                                        <#else>
                                            高级
                                </#if>
                            </#if>
                        </div>
                    </div>
                    <div class="static-item" style="border:none;">
                        <div class="meta">课程时长</div>
                        <div class="meta-value">${(course.time)!}</div>
                    </div>
                    <a id="collectionSpan" onclick="doCollect(${(course.id)!})" href="javascript:void(0)"
                       class="following" style="float: right;margin-top:5px;">
                    </a>
                </div>

                <div class="course-brief">
                    ${(course.brief)!}
                </div>

                <div class="course-menu">
                    <a href="javascript:void(0)">
                        <span onclick="showTab(this,'courseSection')" class="menu-item cur">章节</span>
                    </a>
                    <a href="javascript:void(0)">
                        <span onclick="showTab(this,'commentQA',0)" class="menu-item">评论</span>
                    </a>
                    <a href="javascript:void(0)">
                        <span onclick="showTab(this,'commentQA',1)" class="menu-item">问答</span>
                    </a>
                </div>
            </div>
            <!-- 基础信息 - end -->

            <!-- 章节信息 - start -->
            <div id="courseSection">
                <#if chaptSections??>
                    <#list chaptSections as item>
                        <div class="chapter">
                            <a href="javascript:void(0);" class="js-open">
                                <h3>
                                    <strong>
                                        <div class="icon-chapter">=</div>
                                        ${item.name!}</strong>
                                    <span class="drop-down">▼</span>
                                </h3>
                            </a>
                            <ul class="chapter-sub">
                                <#if item.sections??>
                                    <#list item.sections as section>
                                        <a href="${s.base}/course/video/${section.id!}.html">
                                            <li class="chapter-sub-li">
                                                <i class="icon-video">▶</i>${section.name!} (${section.time!})
                                            </li>
                                        </a>
                                    </#list>
                                </#if>
                            </ul>
                        </div>
                    </#list>
                </#if>

            </div>
            <!-- 章节信息 - end -->

            <!-- 评论区 start -->
            <div id="commentQA">
            </div>
            <!-- 评论区 end -->
        </div>

        <div class="main-course-right">
            <#if courseTeacher??>
                <div class="lecturer-item" style="width: 100%;">
                    <#if courseTeacher.header?? && courseTeacher.header != ''>
                        <img class="lecturer-uimg" src="${courseTeacher.header!}">
                        <#else>
                            <img class="lecturer-uimg" src="${s.base}/res/i/header.jpg">
                    </#if>
                    <span class="lecturer-name">${(courseTeacher.realname)!""}</span>
                    <span class="lecturer-title">${(courseTeacher.collegeName)!""} · ${(courseTeacher.education)!""}</span>
                    <span class="lecturer-p">${(courseTeacher.title)!""}，${(courseTeacher.sign)!""}</span>
                    <a href="javascript:void(0)" onclick="doFollow('${(courseTeacher.id!)}');">
					<span id="followSpan" class="follow-btn">
					<#if followFlag?? && followFlag>
					已关注
					<#else>
					关注+
					</#if>
					</span>
                    </a>
                </div>
            </#if>

            <h4 class="mt-50">推荐课程</h4>
            <#if recomdCourseList?? && recomdCourseList?size gt 0 >
                <#list recomdCourseList as item>
                    <a href="${s.base}/course/learn/${item.id}.html" target="_black" class="mb-5" title="${item.name!}">
                        <li class="ellipsis oc-color-hover">${item.name!}</li>
                    </a>
                </#list>
            </#if>
        </div>

    </div>

</div>

<!-- 页脚-start -->
<div class="f-footer">
    <div class="f-footer-box clearfix">
        <div class="footer-link">
            <a href="javascript:void(0);" target="_blank" title="企业合作">企业合作</a>
            <a href="javascript:void(0);" target="_blank" title="联系我们">联系我们</a>
            <a href="javascript:void(0);" target="_blank" title="常见问题">常见问题</a>
            <a href="javascript:void(0);" target="_blank" title="意见反馈">意见反馈</a>
            <a href="javascript:void(0);" target="_blank" title="友情链接">友情链接</a>
        </div>
        <div class="footer-copyright">
            <span>©&nbsp;2017&nbsp; 备案 </span>
        </div>
    </div>
</div>
<!-- 页脚-end-->


<script type="text/javascript">

    $(function () {
        //实现 章节鼠标焦点 动态效果
        $('.chapter li').hover(function () {
            $(this).find('.icon-video').css('color', '#FFF');
        }, function () {
            $(this).find('.icon-video').css('color', '#777');
        });

        $('.js-open').click(function () {
            var display = $(this).parent().find('ul').css('display');
            if (display == 'none') {
                $(this).parent().find('ul').css('display', 'block');
                $(this).find('.drop-down').html('▼');
            } else {
                $(this).parent().find('ul').css('display', 'none');
                $(this).find('.drop-down').html('▲');
            }
        });

        //判断是否被收藏
        var courseId = ${(course.id)!};//课程id
        if (courseId) {
            var url = '${s.base}/collections/isCollection';
            doCollect(courseId, url);
        }

        //判断是否已经关注教师
        var followId = ${(courseTeacher.id!)};
        if (followId) {
            var url = '${s.base}/follow/isFollow';
            doFollow(followId,url);
        }
    });

    /**
     *展示tab commentQA
     **/
    function showTab(el, divId, type) {
        $('.course-menu').find('span').each(function (i, item) {
            $(item).removeClass('cur');
        })
        $(el).addClass('cur');

        if (divId == 'courseSection') {
            $('#courseSection').show();
            $('#commentQA').hide();
        } else {
            $('#commentQA').show();
            $('#courseSection').hide();
            _queryPage(1, type);//默认加载 第 1 页
        }
    }


    /**
     *加载 课程评论 & 问答
     * courseId：课程id
     * sectionId: 章节id
     * type : 类型 0-评论；1-答疑
     */
    var _type = 0;//全局变量
    function _queryPage(pageNum, type) {
        if (type == undefined) {
            type = _type;
        } else {
            _type = type;
        }
        //加载评论或者QA
        if (pageNum == undefined) {
            pageNum = 1;
        }
        var courseId = ${(course.id)!};//课程id
        var url = '${s.base}/courseComment/segment';
        $("#commentQA").load(
            url,
            {'courseId': courseId, 'type': type, 'pageNum': pageNum},
            function () {
            }
        );
    }

    //收藏
    function doCollect(courseId, url) {
        if (url == undefined) {
            url = '${s.base}/collections/doCollection'
        }
        //处理收藏
        $.ajax({
            url: url,
            type: 'POST',
            dataType: 'json',
            data: {"courseId": courseId},
            success:function(resp){
                if(resp.errcode == 1){//已收藏
                    $('#collectionSpan').attr('class','followed');
                }else if(resp.errcode == 0){//未收藏
                    $('#collectionSpan').attr('class','following');
                }
            }
        });
    }

    //关注
    function doFollow(followId,url) {
        if (url == undefined) {
            url = '${s.base}/follow/doFollow';
        }
        $.ajax({
            url: url,
            type: 'POST',
            dataType: 'json',
            data: {"followId": followId},
            success:function (resp) {
                if(resp.errcode == 1){
                    $('#followSpan').html('已关注');
                }else if(resp.errcode == 0){
                    $('#followSpan').html('+关注');
                }
            }
        });
    }

</script>

</body>

</html>
